# PlayTable Motion Arena

Three.js와 DeviceMotion/DeviceOrientation, WebSocket을 결합해 데스크탑 스크린과 모바일 컨트롤러가 연동되는 온라인 라켓 스포츠(배드민턴, 테니스, 탁구 등) 게임 실험용 스타터 프로젝트입니다.

## 실행

```bash
bun install
bun run src/index.ts
```

서버는 `http://localhost:3000`에서 실행됩니다. 같은 네트워크의 데스크탑·모바일 브라우저에서 접속해 방 생성과 컨트롤러 연결을 테스트하세요.

## 핵심 시나리오

- **데스크탑이 메인 경기 화면**: 코트와 라켓, 팀 구성, 스코어가 표시되며 키보드(WASD, QE, RF)와 마우스로 시점을 조정할 수 있습니다.
- **방 생성 & 관리**: 방 코드를 기반으로 공개/비공개 방을 만들고, 타깃 점수와 경기 시간을 조정할 수 있습니다.
- **팀 관리**: 플레이어는 팀 이동 및 관전/참여 전환이 가능하며, 방장은 플레이어 강제 이동·관전 전환·킥을 수행할 수 있습니다.
- **모바일 컨트롤러**: QR 코드 또는 직접 입력으로 방에 입장한 뒤 센서 권한을 허용하면 라켓 스윙/가속 데이터를 실시간 전송합니다. 방장은 컨트롤러를 특정 플레이어에게 배정할 수 있습니다.
- **멀티 디바이스 스트리밍**: 각 컨트롤러의 입력은 WebSocket을 통해 방의 모든 데스크탑 화면으로 브로드캐스트돼 3D 장면에 반영됩니다.

## 폴더 구조

- `src/index.ts` – Elysia 기반 웹 서버. 방/플레이어/컨트롤러 상태 관리와 WebSocket 이벤트 브로커.
- `public/index.html` – 데스크탑 경기 화면 UI, 방 생성/관리 패널, QR 다이얼로그.
- `public/app.js` – 클라이언트 상태 머신. 방 참여, 팀 관리, 컨트롤러 배정, Three.js 씬 동기화.
- `public/game/GameScene.js` – 코트 렌더링 및 로컬/원격 라켓 트래킹.
- `public/net/NetworkClient.js` – WebSocket 래퍼, 이벤트 리스너 관리, 자동 재연결.
- `public/input/DeviceMotionController.js` – 모바일 센서 권한 흐름과 raw 이벤트 수집.
- `public/controller.html` / `public/controller.js` – 모바일 컨트롤러 전용 UI. 센서 권한 요청, 실시간 입력 전송.
- `public/styles.css` – 데스크탑/모바일 공통 다크 테마 스타일.

## 데스크탑 조작법

- `W/A/S/D` 또는 방향키: 플레이어 위치 이동
- `Space` / `Shift`: 높이 조정
- `Q` / `E`: 좌우 회전
- `R` / `F`: 상하 회전
- 마우스 드래그: 라켓/시점 세밀 조정

## 모바일 컨트롤러 가이드

1. 메인 스크린에서 방을 만든 뒤 **QR 코드 보기** 버튼으로 컨트롤러 페이지 URL을 확인합니다.
2. 모바일 브라우저에서 링크를 열고 방 코드와 기기 이름을 입력합니다.
3. **센서 권한 요청** 버튼을 눌러 가속도계/자이로 접근을 허용합니다.
4. 방장이 컨트롤러를 플레이어에 배정하면 스윙/이동/회전 데이터가 경기에 반영됩니다.

## 향후 확장 아이디어

1. 점수판 업데이트, 자동 랠리 종료 판정, 타이머 만료 처리 등 경기 로직을 구현하세요.
2. 룸 매칭 및 다중 방 리스트, 공개방 검색 기능을 추가해보세요.
3. 컨트롤러 UI에 햅틱/버튼 입력을 도입해 스매시, 드롭샷 등 기술을 확장하세요.
4. PWA 및 오프라인 캐시를 적용해 모바일 컨트롤러 사용성을 강화하세요.
